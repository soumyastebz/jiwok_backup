<?phpsession_start();include_once('includeconfig.php');//include_once('user_logged.php');include_once('./includes/classes/class.member.php');include_once('includes/classes/class.massmail.php');$parObj 		=   new Contents('giftreg.php');$objGen   		=	new General();$dbObj     		=   new DbAction();$objMember		= 	new Member($lanId);$objMassmail	=   new Massmail($lanId);unset($_SESSION['registration']);unset($_SESSION['login']);$membqry="SELECT membership_fee,membership_feedollar FROM settings";$membreslt = $GLOBALS['db']->getAll($membqry, DB_FETCHMODE_ASSOC);if($lanId ==1){	$fee= $membreslt[0]['membership_feedollar'];}else{	$fee= $membreslt[0]['membership_fee'];}$_SESSION['memberfee']=$membreslt[0]['membership_fee'];if($lanId=="") $lanId=1;$returnData		= $parObj->_getTagcontents($xmlPath,'registrationGift','label');$arrayData		= $returnData['general'];$errorReturn=$parObj->_getTagcontents($xmlPath,'registrationGift','messages');$errorData=$errorReturn['errorMessage'];//Find all payment plan for displaying plans$planQuery  	=	"select * from jiwok_payment_plan where plan_status=1 and  plan_currency='".$lanId."' AND plan_id	!=1	ORDER BY plan_id ASC";$planResult		= 	$GLOBALS['db']->getAll($planQuery,DB_FETCHMODE_ASSOC);if(isset($_POST['submit'])){		$errorMsg = 0;	if(trim($_POST['user_fname']) == ''){ 		$errorMsg = 1; 		$fname = $parObj->_getLabenames($errorData,'fname','name');		$err1 = 1; 	}	if(trim($_POST['user_fname']) != ''){	if($lanId!=5)	{	$pattern 	= 	'/^[A-Za-z\W \xC0-\xFF]([A-Za-z\W \xC0-\xFF\s]*[A-Za-z\W \xC0-\xFF])*$/u';	}	else	{	$pattern 	= 	'/^\p{L}[\p{L} _.-]+$/u';	}		$okay 	= 	preg_match($pattern,trim($_POST['user_fname']));		if(!$okay){				$errorMsg = 1; 			$fname = $parObj->_getLabenames($errorData,'fnameerr','name'); 			$err1 = 1; 		}	}	if(trim($_POST['user_lname']) == ''){ 		$errorMsg = 1; 		$lname = $parObj->_getLabenames($errorData,'lname','name'); 		$err2 = 1; 	}    if(trim($_POST['user_lname']) != ''){		if($lanId!=5){		//$pattern 	= 	'/^[A-Za-z\xC0-\xFF]([A-Za-z\xC0-\xFF\s]*[A-Za-z\xC0-\xFF])*$/u';		$pattern 	= 	'/^[A-Za-z\W \xC0-\xFF]([A-Za-z\W \xC0-\xFF\s]*[A-Za-z\W \xC0-\xFF])*$/u';	}	else	{	$pattern 	= 	'/^\p{L}[\p{L} _.-]+$/u';	}			$okay 	= 	preg_match($pattern,trim($_POST['user_lname']));		if(!$okay)	{				$errorMsg = 1; 			$lname = $parObj->_getLabenames($errorData,'lnameerr','name'); 			$err2 = 1; 		}	}	if(trim($_POST['user_email']) == ''){ 		$email1 = $parObj->_getLabenames($errorData,'noemail','name'); 		$errorMsg = 1; 		$err3 = 1; 	}	if(trim($_POST['user_email']) != ''){		if(!eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,15})$", trim($_POST['user_email']))){			$email1 = $parObj->_getLabenames($errorData,'emailerr','name'); 			$errorMsg = 1; 			$err3 = 1; 		}	}	if(trim($_POST['c_user_email']) == '') { 		$email2 = $parObj->_getLabenames($errorData,'noemail','name'); 		$errorMsg = 1; 		$text1 = 0; 		$err4 = 1; 	}	if(trim($_POST['c_user_email']) != ''){		if(!eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,15})$", trim($_POST['c_user_email']))){			$email2 = $parObj->_getLabenames($errorData,'emailerr','name'); 			$errorMsg = 1; 			$err4 = 1; 		}	}	if($errorMsg == 0 && trim($_POST['user_email']) != '' && trim($_POST['c_user_email']) != ''){		if(0 != strcmp($_POST['user_email'],$_POST['c_user_email'])){			$errorMsg = 1; 			$email2 = $parObj->_getLabenames($errorData,'ckemail','name'); 			$err4 = 1;		}	}	if($_POST['gift_type'] == '') { 		$errorMsg = 1; 		$gifttype = $parObj->_getLabenames($errorData,'gifttype','name'); 		$errtype = 1; 	}	if($_POST['gift_friend'] == '') { 		$errorMsg = 1; 		$gifttype = $parObj->_getLabenames($errorData,'giftfriend','name'); 		$err5 = 1; 	}	if($_POST['gift_friend'] == 0){ 		if(trim($_POST['first_name']) == ''){ 			$errorMsg = 1; 			$friendnameb = $parObj->_getLabenames($errorData,'fname','name'); 			$err6 = 1; 		}		if(trim($_POST['last_name']) == ''){ 			$errorMsg = 1; 			$friendnamel = $parObj->_getLabenames($errorData,'lname','name'); 			$err61 = 1; 		}		if(trim($_POST['first_name']) != '' && trim($_POST['last_name'])){			// "/^[A-Za-z]([A-Za-z\s]*[A-Za-z])*$/"    OLD -   '/^[a-zA-Z\']+$/'			if($lanId!=5){				$pattern 	= 	'/^[A-Za-z\W\xC0-\xFF]([A-Za-z\W\xC0-\xFF\s]*[A-Za-z\W\xC0-\xFF])*$/u';				}			else			{				$pattern 	= 	'/^\p{L}[\p{L} _.-]+$/u';			}			$okay 	= 	preg_match($pattern,trim($_POST['first_name']));			$yes = 0;			if(!$okay)	{					$errorMsg = 1; 				$friendnameb= $parObj->_getLabenames($errorData,'fnameerr','name'); 				$err6 = 1; 				$yes = 1;			}			$okay1 	= 	preg_match($pattern,trim($_POST['last_name']));			if(!$okay1)	{					$errorMsg = 1; 				$friendnamel= $parObj->_getLabenames($errorData,'lnameerr','name'); 				$err61 = 1; 				$yes = 1;			}			if($yes == 0){				$giftfriendname = $_POST['first_name'].' '.$_POST['last_name'];			}		}		if(trim($_POST['friend_email']) == ''){ 			$email1b = $parObj->_getLabenames($errorData,'noemail','name'); 			$errorMsg = 1; 			$err7 = 1; 		}		if(trim($_POST['friend_email']) != ''){			if(!eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,15})$", trim($_POST['friend_email']))){				$email1b = $parObj->_getLabenames($errorData,'emailerr','name'); 				$errorMsg = 1; 				$err7 = 1; 			}		}		if(trim($_POST['c_friend_email']) == '') { 			$email2b = $parObj->_getLabenames($errorData,'noemail','name'); 			$errorMsg = 1; 			$text1 = 0; 			$err8 = 1; 		}		if(trim($_POST['c_friend_email']) != ''){			if(!eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,15})$", trim($_POST['c_friend_email']))){				$email2b = $parObj->_getLabenames($errorData,'emailerr','name'); 				$errorMsg = 1; 				$err8 = 1; 			}		}		if($errorMsg == 0 && trim($_POST['friend_email']) != '' && trim($_POST['c_friend_email']) != ''){			if(0 != strcmp($_POST['friend_email'],$_POST['c_friend_email'])){				$errorMsg = 1; 				$email2b = $parObj->_getLabenames($errorData,'ckemail','name'); 				$err8 = 1;			}else{				$giftfriendemail = $_POST['friend_email'];			}		}	}else{		$giftfriendname = 'empty';		$giftfriendemail = 'empty';	}	// If the reg1 is success then go to step2	if($errorMsg == 0){				$planQuery  	=	"select * from jiwok_payment_plan where plan_status=1 and  plan_currency='".$lanId."' AND plan_amount=".$_POST['gift_type'];		$planResult		= 	$GLOBALS['db']->getRow($planQuery,DB_FETCHMODE_ASSOC);				$_SESSION['giftsubscription'] = 'TRUE';		$_SESSION['user_name'] 		=	$_POST['user_fname'];		$_SESSION['user_lname'] 	=	$_POST['user_lname'];		$_SESSION['user_email'] 	=	$_POST['user_email'];		$_SESSION['gift_type'] 		=	$planResult[plan_duration];		$_SESSION['friend_name'] 	=	$giftfriendname ;		$_SESSION['friend_email'] 	=	$giftfriendemail;		$_SESSION['gift_friend']    =   $_POST['gift_friend'];		$_SESSION['frend_msg']      =   $_POST['friend_msg'];		$_SESSION['user_doj'] 		=	date('Y-m-d');		$_SESSION['giftregistration'] 		=	$_POST;//print_r($_SESSION['giftregistration']);exit;		$reg = $objGen->_clearElmtsWithoutTrim($_SESSION['giftregistration']);		//insert member to the gift_member table		//Getting the value of next id to put it in user_ptions as usermaster_id.		header("Location:gift_payment.php");		exit;	}}?><?php include("header.php"); ?> <script src="js/flaunt.js"></script><style>.has-js .label_check, .has-js .label_radio {  display:inline-block;}</style>    <div class="frame_inner">    <div class="row-1">				 <ul class="bredcrumbs">            <li><?=$parObj->_getLabenames($arrayData,'newPageTxt','name');?> :</li>        <li><a href="<?=ROOT_JWPATH?>index.php"><?=$parObj->_getLabenames($arrayData,'newHmeTxt','name');?></a></li>        <li>></li>              <li><a style="color: #E67F23;"><?=$parObj->_getLabenames($arrayData,'newHeadTxt','name');?></a></li>                           </ul>				<div class="return">            <a href="<?=$backButtonLink?>"><?=$parObj->_getLabenames($arrayData,'newBckTxt','name');?></a>         </div>         <div class="title">           <h3><?=$parObj->_getLabenames($arrayData,'newHeadTxt','name');?> </h3>           <?php if($lanId!=5 ){?>			   <?=$parObj->_getLabenames($arrayData,'newDescTxt','name');?><?php }?>                   </div>                  </div>           <section class="profile">         <div class="left">               <section class="coupons">                   <p class="single">                       <img src="<?=ROOT_FOLDER?>images/coupon-1.png" alt="Jiwok coupon"></p>                   <span class="double">                       <img src="<?=ROOT_FOLDER?>images/coupon-2.png" alt="Jiwok coupon"></span>                   <span class="double">                       <img src="<?=ROOT_FOLDER?>images/coupon-3.png" alt="Jiwok coupon"></span>               </section>                     </div>       <div class="profile-edit">        <form name="giftregForm" action="giftreg.php" method="post" >          <div class="bloks reg">           <div class="rows first">               <div class="col-01"><?=$parObj->_getLabenames($arrayData,'newYrDtlsTxt','name');?></div>               <div class="col-02" style="font-size: 14.39px;">* <?=$parObj->_getLabenames($arrayData,'newMtrFldsTxt','name');?></div>            </div><!--        somethg pending--><!--           <div <? if($err1 == 1){ ?> class="rows error"<? }?>>-->            <div class="rows"><? if($err1 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark"   onMouseOver="tooltip('<?=$fname?>');" onMouseOut="exit();"><? }?>               <div class="col-01">* <?=$parObj->_getLabenames($arrayData,'newFNameTxt','name');?></div>               <div class="col-02" ><input name="user_fname" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['user_fname'])?>"></div>            <? if($err1 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($err2 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark"  onMouseOver="tooltip('<?=$lname?>');" onMouseOut="exit();"><? }?>               <div class="col-01">* <?=$parObj->_getLabenames($arrayData,'newLNameTxt','name');?></div>               <div class="col-02"><input name="user_lname" id="textfield"  type="text" class="tfl" value="<?=stripslashes($_POST['user_lname'])?>"></div>             <? if($err2 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($err3 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark"  onMouseOver="tooltip('<?=$email1?>');" onMouseOut="exit();"><? }?>               <div class="col-01">* <?=$parObj->_getLabenames($arrayData,'newEMailTxt','name');?></div>               <div class="col-02"><input name="user_email" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['user_email'])?>"></div>            <? if($err3 == 1){ ?></div><?}?>            </div>            <div class="rows"> <? if($err4 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark" onMouseOver="tooltip('<?=$email2?>');" onMouseOut="exit();"><? }?>              <div class="col-01">* <?=$parObj->_getLabenames($arrayData,'newConfirmTxt','name');?></div>               <div class="col-02">               <div class="selet2">                 <input name="c_user_email" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['c_user_email'])?>">               </div>                          </div>  <? if($err4 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($errtype== 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark" onMouseOver="tooltip('<?=$gifttype?>');" onMouseOut="exit();"><? }?>                   <div class="col-01">* <?=$parObj->_getLabenames($arrayData,'newTheTxt','name');?></div>                   <div class="col-02">                                        <div class="split">                   <div class="selet3">                   <select name="gift_type"  onChange="getGiftAmount(gift_type[gift_type.selectedIndex].value);"> 					   <option value="">Select</option>					    <?php					 foreach($planResult as $planResults)					 {					 ?>                     	<option value="<?=$planResults[plan_amount]?>" <?php if($planResults[plan_amount]==$_POST['gift_type']){?>selected="selected" <?php }?>><?=$planResults[plan_id]?></option>                                             <?php }?>  					   </select></div></div>                   <div class="split month"><?=$parObj->_getLabenames($arrayData,'newMonthTxt','name');?> =<span id="price" >0<?=$parObj->_getLabenames($arrayData,'curr','name');?></span> </div>                   </div><? if($errtype == 1){ ?></div><?}?>            </div>            <div class="rows">				<div class="col-01"><?=$parObj->_getLabenames($arrayData,'newQstnTxt','name');?></div>            <div class="col-02">	 <label class="label_radio" > <input type="radio" name="gift_friend" id="radio" <? if(trim($_POST['gift_friend']) == "0") { echo 'checked="checked"'; } ?>  value="0" onClick="showdiv('<?php echo 0 ;?>')" /><?=$parObj->_getLabenames($arrayData,'newYesTxt','name');?></label>    <label class="label_radio" > <input type="radio"  name="gift_friend" id="radio2" <? if(trim($_POST['gift_friend']) != "0"   || $_POST['gift_friend'] == "") { echo 'checked="checked"'; } ?> value="1" onClick="showdiv('<?php echo 1 ;?>')" /><?=$parObj->_getLabenames($arrayData,'newNoTxt','name');?>  </label>  </div>     </div>                  </div>                   <input type="hidden" id="feeElement" value="<?php echo $fee;?>"  />		  <input type="hidden" id="lanidsElement" value="<?php echo $lanId;?>"  />         <!---added neethu for radio button action form-->         <div  id="imperial" style="display: <?php if  (trim($_POST['gift_friend'])=="0") echo 'block'; else echo "none"; ?>;">		  <div class="rows"><? if($err6 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark" onMouseOver="tooltip('<?=$friendnameb?>');" onMouseOut="exit();"><? }?>               <div class="col-01" style="color: #2A80B9;">* <?=$parObj->_getLabenames($arrayData,'fname','name');?></div>               <div class="col-02"><input name="first_name" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['first_name'])?>" ></div>            <? if($err6 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($err61 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark" onMouseOver="tooltip('<?=$friendnamel?>');" onMouseOut="exit();"><? }?>               <div class="col-01" style="color: #2A80B9;">* <?=$parObj->_getLabenames($arrayData,'lname','name');?></div>               <div class="col-02"><input name="last_name" id="textfield"  type="text" class="tfl" value="<?=stripslashes($_POST['last_name'])?>"></div>            <? if($err61 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($err7== 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark" onMouseOver="tooltip('<?=$email1b?>');" onMouseOut="exit();"><? }?>               <div class="col-01" style="color: #2A80B9;">* <?=$parObj->_getLabenames($arrayData,'friendemail','name');?></div>               <div class="col-02"><input name="friend_email" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['friend_email'])?>" /></div>            <? if($err7 == 1){ ?></div><?}?>            </div>            <div class="rows"><? if($err8 == 1){ ?><div class="prf_err"> <img src="images/help_editprfl.png" class="Q-mark"  onMouseOver="tooltip('<?=$email2b?>');" onMouseOut="exit();"><? }?>               <div class="col-01" style="color: #2A80B9;">* <?=$parObj->_getLabenames($arrayData,'cfriendemail','name');?></div>               <div class="col-02"><input name="c_friend_email" id="textfield" type="text" class="tfl" value="<?=stripslashes($_POST['c_friend_email'])?>" /></div>              <? if($err8 == 1){ ?></div><?}?>            </div>            <div class="rows">               <div class="col-01" style="color: #2A80B9;">* <?=$parObj->_getLabenames($arrayData,'friendmsg','name');?></div>               <div class="col-02"><textarea  class="txr"  name="friend_msg" id="friend_msg" type="textarea" value="<?=stripslashes($_POST['friend_msg'])?>" ></textarea></div>            </div></div>            <!---radio button action form ends-->                     <p align="right"><input type="submit" name="submit" class="btn_orng reg" value="<?=$parObj->_getLabenames($arrayData,'newNextStepTxt','name');?>"></p>          <!--<p><a href="#" class="btn_orng">MODIFIEZ VOTRE PROFIL</a></p>-->             </form>               </div>       </section>            </div>                    <!--     <div class="foot-nav frame">                                                                                                                                                                      <ul class="nav_03">          <li><a href="#">aide</a></li>          <li><a href="#">plan du site</a></li>          <li><a href="#">qui sommes nous?</a></li>          <li><a href="#">termes et conditions</a></li>        </ul>     </div>    -->                    </div>   		<!-- Demo Analytics -->        <script>		//~ function showdiv()		//~ {			//~ alert("kkkkkkk");return false;		//~ }	    var d = document;    var safari = (navigator.userAgent.toLowerCase().indexOf('safari') != -1) ? true : false;    var gebtn = function(parEl,child) { return parEl.getElementsByTagName(child); };    onload = function() {                var body = gebtn(d,'body')[0];        body.className = body.className && body.className != '' ? body.className + ' has-js' : 'has-js';                if (!d.getElementById || !d.createTextNode) return;        var ls = gebtn(d,'label');        for (var i = 0; i < ls.length; i++) {            var l = ls[i];            if (l.className.indexOf('label_') == -1) continue;            var inp = gebtn(l,'input')[0];            if (l.className == 'label_check') {                l.className = (safari && inp.checked == true || inp.checked) ? 'label_check c_on' : 'label_check c_off';                l.onclick = check_it;            };            if (l.className == 'label_radio') {                l.className = (safari && inp.checked == true || inp.checked) ? 'label_radio r_on' : 'label_radio r_off';                l.onclick = turn_radio;            };        };    };    var check_it = function() {        var inp = gebtn(this,'input')[0];        if (this.className == 'label_check c_off' || (!safari && inp.checked)) {            this.className = 'label_check c_on';            if (safari) inp.click();        } else {            this.className = 'label_check c_off';            if (safari) inp.click();        };    };    var turn_radio = function() {         var inp = gebtn(this,'input')[0];        if (this.className == 'label_radio r_off' || inp.checked) {            var ls = gebtn(this.parentNode,'label');            for (var i = 0; i < ls.length; i++) {                var l = ls[i];                if (l.className.indexOf('label_radio') == -1)  continue;                l.className = 'label_radio r_off';            };            this.className = 'label_radio r_on';            if (safari) inp.click();        } else {            this.className = 'label_radio r_off';            if (safari) inp.click();        };    };</script><?php include("footer.php"); ?>