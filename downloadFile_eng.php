<?phpsession_start();include_once('includeconfig.php');include_once("includes/classes/class.programs_eng.php");include_once("includes/classes/class.Languages.php");//http://www.jiwok.com/en/downloadFile_eng.php?//include_once("includes/trak_analysis.php");if($lanId=="")     $lanId=1;$errorMsg = '';	// query string not encoded.. work around $qry_strng = $_SERVER['QUERY_STRING'];$tmp= explode('&',$qry_strng);$pgf_tmp = explode('pgmFlex=',$tmp[0]);$pgmFlex = $pgf_tmp[1]; $wf_tmp= explode('workFlex=',$tmp[1]);$workFlex = $wf_tmp[1];$pgmid = trim($_REQUEST['pgmid']);$userid		= $_SESSION['user']['userId'];//took all informations$objGen     	= new General();$objPgm     	= new Programs($lanId);$objLan    		= new Language();$parObj 		= new Contents();//$trakObj		=	new trakAnalysis();$returnData		= $parObj->_getTagcontents($xmlPath,'trainingprogram','label');$arrayData		= $returnData['general'];$lanName =  strtolower($objLan->_getLanguagename($lanId));/////////////////////////////////////////////////////////////$pgmFlex1	= trim(stripslashes($_REQUEST['pgmFlex']));$vocal_select	= trim(stripslashes($_REQUEST['vocal']));$workFlex1	= trim(stripslashes($_REQUEST['workflex1']));$wFlex  = str_replace('%20',' ',trim($workFlex1));$wFlex  = str_replace('%2B','+',$wFlex);$pgmFlex1  = str_replace('%20',' ',trim($pgmFlex1));$pgmFlex1  = str_replace('%2B','+',$pgmFlex1);//echo $wFlex;$genreList  	= trim(stripslashes($_REQUEST['genList']));$f_rem			= trim($_REQUEST['rem']);$lang			= trim($_REQUEST['lang']);$vocal			= trim($_REQUEST['vocals']); $f_vocal		= trim($_REQUEST['vocal']);$bgmusic		= trim($_REQUEST['bgmusic']);if($bgmusic== "") 	  $bgmusic = 1;//$vocal_type	= ( (int) trim($_REQUEST['vocal']) ) == 1 ? 1 : 2; // vocal_type, if checked 1 else 2if($genreList==""){	$res		= $objPgm->_getSelectedGenres('',$userid);}if(count($res)>0){for($i=0;$i<count($res);$i++){	$genreArray[] = trim(stripslashes($res[$i]['genre_name']));}$selected_genre = implode(',',$genreArray);}else{ $selected_genre = ''; }if($genreList==""){$generlist	=	$selected_genre;}else{$generlist	=	$genreList;}$user = $objPgm->_getUserDetails($userid);$user_email 	= $user['user_email'];		$dayTime	= date('Y-m-d H:i:s',time());	$tmpUserMemoryArr	= $objPgm->_getUserMemoryGenres($userid);	$memoryGenre		= "";	if(trim($genreList)==''){			$f_random_genre_status	= 1;	}	if(trim($genreList)!=''){		$f_random_genre_status		= 0;		$f_memoryGenre				= $genreList;	}	if(count($tmpUserMemoryArr)==0){		$objPgm->_insertInToUserSongMemory($user_email, $userid, $dayTime, $vocal_type, $random_genre_status, $rem, $memoryGenre,$f_vocal,$f_rem,$f_random_genre_status,$f_memoryGenre);	}else{		$objPgm->_updateMemoryGenreStatus($memoryGenre, $vocal_type, $random_genre_status, $rem, $userid,$f_vocal,$f_rem,$f_random_genre_status,$f_memoryGenre);	}$workoutOrderNumber	= $_GET['pageNum'];$invoke_time = date('Y-m-d H:i:s ');$brand_id ="";$insArray   = array('user_name'=>addslashes(trim($user_email)),'user_id'=>addslashes($userid),'program_flex_id'=>addslashes($pgmFlex1),'workout_flex_id'=>addslashes($wFlex),'invoke_time'=>addslashes($invoke_time),'status'=>7,					'selected_genre'=>addslashes(trim($generlist)), 'vocals_only'=>addslashes(trim($vocal_select)), 'workoutOrderNumber'=>$workoutOrderNumber,'voicegrade'=>$vocal,'workout_lang_selected'=>$lang,'user_lang'=>$lanId,'vocal_type'=>$lanId,'brand_id'=>$brand_id, 'bgmusic_on'=>$bgmusic);//, 'bgmusic_on'=>$bgmusic$objPgm->_insertDetails($insArray,'program_queue');//for traking python workout generation$workoutDetail 		= $objPgm->_getWorkoutDetailAll(trim(str_replace(' ','',$wFlex)),$lanId);$workout_title 		= trim(stripslashes($workoutDetail['workout_title']));$property	=	array("Source" =>"Python","Title"=>$workout_title, "email"=>$user_email,"Section No"=>$workoutOrderNumber);//$response 	=	$trakObj->trakWorkOutGeneration($user_email,$property);if($rem==1)	{ $update = $objPgm->_updateGenreStatus($genreList,$userid); }///////////////////////////////////////////$pgmFlex	= trim(stripslashes($_REQUEST['pgmFlex']));//$workFlex	= trim(stripslashes($_REQUEST['workFlex']));$jiwokGenreList  = trim(stripslashes($_REQUEST['jiwokGenList']));$genreArray = array();$genreArray = explode(',',$jiwokGenreList);$genreString = implode('',$genreArray);$workOrder = $objPgm->_getWorkoutOrder($pgmFlex,$workFlex,$lanId);$fPattern2 	 = array('/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/','/�/', '/�/','/�/','/�/','/�/','/�/');$fReplace2 	 = array('a','e','A','E','e','E','a','e','i','o','u','A','E','I','O','U','a','e','i','o','u','A','E','I','O','U','c','C');$workFlex_new = preg_replace($fPattern2,$fReplace2,$workFlex);$myFile1 = "./uploads/staticworkouts/".$lanName."/".$workFlex_new."_".$genreString.".mp3";if(file_exists($myFile1)){$gen_tmp = $genreString."_".$workOrder;echo "<p align=\"center\" ><strong>".$parObj->_getLabenames($arrayData,'yourworkout','name')."</strong></p><p align=\"center\" id=\"download_btn2\"><font color=\"#0000000\"></font></p><input type=\"hidden\" id=\"work\" value=\"$workFlex_new\" /><input type=\"hidden\" id=\"gen\" value=\"$gen_tmp \" /><p align=\"center\" id=\"loader_image2\" style=\"visibility: hidden; display: none;\"> <strong>".$parObj->_getLabenames($arrayData,'staticdownload','name')."</strong><img align=\"center\" src=\"images/ajax_loader.gif\" style=\"margin-left:150px;\"/></p><p align=\"center\" id=\"alter_download\" style=\"visibility: hidden; display: none;\"><font color=\"#0000000\">".$parObj->_getLabenames($arrayData,'alterdwd','name')."</font></p><p align=\"center\" id=\"alter_download2\" style=\"visibility: hidden; display: none;\"><a href=\"download_static_MP3.php?work=$workFlex_new&gen=$gen_tmp&pid=$pgmid\" target=\"_blank\">".$parObj->_getLabenames($arrayData,'downld','name')."</a></p>";}else{echo	"<table width=\"100%\" border=\"0\" cellspacing=\"2\" cellpadding=\"0\" class=\"content\">			  <tr>				<td align=\"center\">".$parObj->_getLabenames($arrayData,'filenotfoundmsg','name')."</td>			  </tr>";			  if($lanId==2)			  {				  echo "<tr>				<td align=\"center\">".$parObj->_getLabenames($arrayData,'filenotfoundmsg1','name')."</td>			  </tr>";			  }			  			  			echo "</table>";//echo "<h1 align=\"center\" ><strong>".$parObj->_getLabenames($arrayData,'filenotfoundmsg','name')."</strong></h1>";}?>